# This workflow will build a golang project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-go
name: release-please

on:
  push:
    branches:
      - main

permissions:
  contents: write
  pull-requests: write
  issues: write # needed if using builtin secrets.GITHUB_TOKEN


jobs:
  release-please:
    runs-on: windows-latest
    env:
      MAIN_PATH: "./cmd/nomad"
    steps:
      - uses: googleapis/release-please-action@v4
        id: release
        with:
          release-type: simple

      - uses: actions/checkout@v4
      - name: Build apps
        shell: pwsh
        run: |
             & build.ps1 apps.test.json
             cp VERSION.txt  build
             cp install.ps1 build
             cp setup-user-env.ps1 build
             
      - name: Zip
        if: steps.release.outputs.release_created
        shell: pwsh
        run: |
             Compress-Archive build/* toolset.zip

      - name: Upload Release Asset
        if: ${{steps.release.outputs.release_created}}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh release upload ${{ steps.release.outputs.tag_name }} toolset.zip
